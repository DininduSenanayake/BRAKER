# Katharina J. Hoff
# October 12th 2017
# Example data for BRAKER2 with RNA-Seq & proteins (GeneMark-ET training with RNA-Seq)

# downloaded proteins of d. ana from flybase (ftp://ftp.flybase.net/releases/FB2017_04/dana_r1.05/fasta/dana-all-translation-r1.05.fasta.gz) because accessing data from the tape archiving robot takes way too much time.

grep -c ">" dana-all-translation-r1.05.fasta # 21191

cat dana-all-translation-r1.05.fasta | perl -ne 'if(m/>/){@t=split; print $t[0]."\n";}else{print $_;}' > proteins.fa

startAlign.pl --genome=/home/katharina/SVN/braker/trunks/example/example.fa --prot=/home/katharina/braker_test/Drosophila_melanogaster_6/data/proteins/proteins.fa--ALIGNMENT_TOOL_PATH=/home/katharina/gth/bin --prg=gth

# the following has not been executed, yet
cat align_gth/gth.concat.aln | perl -ne 'if(m/Target=(.*)\s\d/){@t = split(/\s/, $1); print $t[0]."\n";}' | sort -u > proteins.lst

cdbfasta proteins.fa -o proteins.fa.idx

cat proteins.lst | cdbyank proteins.fa.idx -d proteins.fa > example_proteins.fa

# create example bam file
export PATH=$PATH:/home/tool:/home/tool/tophat2:/home/tool/bowtie2:
p="/home/braker/project2/Drosophila_melanogaster/arx"

bowtie2-build genome.fa genome

nohup tophat2  --num-threads 4  --microexon-search  --mate-std-dev 26  --mate-inner-dist 38  --min-intron-length 30  --min-coverage-intron 30 --min-segment-intron 30   -o ./tophat_out  genome   $p/SRR023505_1.fastq,$p/SRR023546_1.fastq,$p/SRR023608_1.fastq,$p/SRR026433_1.fastq,$p/SRR027108_1.fastq  $p/SRR023505_2.fastq,$p/SRR023546_2.fastq,$p/SRR023608_2.fastq,$p/SRR026433_2.fastq,$p/SRR027108_2.fastq > loginfo &

# May 18th 2018
# Want to build a smaller example because runtime for testing is to big

cdbfasta genome.fa -o genome.fa.idx

# retrieve only 1/6 of chr2 sequence: 1:4213838

cdbyank genome.fa.idx -d genome.fa -a '2R 1 4213838' -R > genome.small.fa

mv genome.small.fa genome.fa

# get rnaseq reads from rgasp that map to 2R
wget http://bioinf.uni-greifswald.de/augustus/binaries/tutorial/data/rgasp_fly_2R.fastq.gz
gunzip rgasp_fly_2R.fastq.gz
cat rgasp_fly_2R.fastq | perl -ne 'if(m/\/1$/){$p = 1}elsif(m/\/2$/){$p = 0} if($p==1){print $_;}' > rnaseq_1.fq
cat rgasp_fly_2R.fastq | perl -ne 'if(m/\/1$/){$p = 0}elsif(m/\/2$/){$p = 1} if($p==1){print $_;}' > rnaseq_2.fq

bowtie2-build genome.fa genome

tophat2  --num-threads 7  --microexon-search  --mate-std-dev 26  --mate-inner-dist 38  --min-intron-length 30  --min-coverage-intron 30 --min-segment-intron 30   -o ./tophat_out  genome  rnaseq_1.fq  rnaseq_2.fq > loginfo &
